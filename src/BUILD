cc_binary(
    name = "cc_ast_tool",
    srcs = ["cc_ast_tool.cc"],
    visibility = ["//visibility:public"],
    deps = [
        ":cc_ast_tool_lib",
        ":cast_visitor",
        ":goto_visitor",
        ":nobreak_visitor",
        "@absl//absl/flags:flag",
        "@absl//absl/flags:parse",
        "@absl//absl/flags:usage",
        "@absl//absl/log:check",
        "@absl//absl/status:statusor",
        "@rapidjson",
    ],
    # TODO: solve hardcoded system args
    args = [
        "--undefok",
        "-cc1",
        "--undefok",
        "-triple",
        "--undefok",
        "x86_64-apple-macosx11.0.0",
        "--undefok",
        "-Wundef-prefix=TARGET_OS_",
        "--undefok",
        "-Werror=undef-prefix",
        "--undefok",
        "-Wdeprecated-objc-isa-usage",
        "--undefok",
        "-Werror=deprecated-objc-isa-usage", 
        "--undefok",
        "-emit-obj",
        "--undefok",
        "-mrelax-all",
        "--undefok",
        "--mrelax-relocations",
        "--undefok",
        "-disable-free",
        "--undefok",
        "-clear-ast-before-backend",
        "--undefok",
        "-disable-llvm-verifier",
        "--undefok",
        "-discard-value-names",
        "--undefok",
        "-mrelocation-model",
        "--undefok",
        "pic",
        "--undefok",
        "-pic-level",
        "--undefok",
        "2",
        "--undefok",
        "-mframe-pointer=all",
        "--undefok",
        "-ffp-contract=on",
        "--undefok",
        "-fno-rounding-math",
        "--undefok",
        "-funwind-tables=2",
        "--undefok",
        "-fcompatibility-qualified-id-block-type-checking",
        "--undefok",
        "-fvisibility-inlines-hidden-static-local-var",
        "--undefok",
        "-target-cpu",
        "--undefok",
        "penryn",
        "--undefok",
        "-tune-cpu",
        "--undefok",
        "generic",
        "--undefok",
        "-mllvm",
        "--undefok",
        "-treat-scalable-fixed-error-as-warning",
        "--undefok",
        "-debugger-tuning=lldb",
        "--undefok",
        "-target-linker-version",
        "--undefok",
        "711", 
        "--undefok",
        "-v", 
        "--undefok",
        "-fcoverage-compilation-dir=/Users/henriquepreto/Desktop/cc-ast-tool",
        "--undefok",
        "-resource-dir /usr/local/Cellar/llvm@14/14.0.6/lib/clang/14.0.6",
        "--undefok",
        "-isysroot",
        "--undefok",
        "/Library/Developer/CommandLineTools/SDKs/MacOSX11.sdk",
        "--undefok",
        "-stdlib=libc++",
        "--undefok",
        "-internal-isystem",
        "--undefok",
        "/usr/local/opt/llvm@14/bin/../include/c++/v1",
        "--undefok",
        "-internal-isystem",
        "--undefok",
        "/Library/Developer/CommandLineTools/SDKs/MacOSX11.sdk/usr/local/include",
        "--undefok",
        "-internal-isystem",
        "--undefok",
        "/usr/local/Cellar/llvm@14/14.0.6/lib/clang/14.0.6/include",
        "--undefok",
        "-internal-externc-isystem",
        "--undefok",
        "/Library/Developer/CommandLineTools/SDKs/MacOSX11.sdk/usr/include",
        "--undefok",
        "-fdeprecated-macro",
        "--undefok",
        "-fdebug-compilation-dir=/Users/henriquepreto/Desktop/cc-ast-tool",
        "--undefok",
        "-ferror-limit",
        "--undefok",
        "19",
        "--undefok",
        "-stack-protector",
        "--undefok",
        "1",
        "--undefok",
        "-fblocks",
        "--undefok",
        "-fencode-extended-block-signature",
        "--undefok",
        "-fregister-global-dtors-with-atexit",
        "--undefok",
        "-fgnuc-version=4.2.1",
        "--undefok",
        "-fcxx-exceptions",
        "--undefok",
        "-fexceptions",
        "--undefok",
        "-fmax-type-align=16",
        "--undefok",
        "-fcolor-diagnostics",
        "--undefok",
        "-D__GCC_HAVE_DWARF2_CFI_ASM=1",
    ]
)

cc_library(
    name = "frontend_action",
    hdrs = ["frontend_action.h"],
    deps = [
        ":ast_consumer",
        "@llvm-project//clang:ast",
        "@llvm-project//clang:frontend",
    ],
)

cc_library(
    name = "ast_consumer",
    hdrs = ["ast_consumer.h"],
    deps = [
        "@llvm-project//clang:ast",
    ],
)

cc_library(
    name = "cast_visitor",
    srcs = ["cast_visitor.cc"],
    hdrs = ["cast_visitor.h"],
    deps = [
        ":visitor",
        "@rapidjson",
    ],
)

cc_library(
    name = "goto_visitor",
    srcs = ["goto_visitor.cc"],
    hdrs = ["goto_visitor.h"],
    deps = [
        ":visitor",
        "@rapidjson",
    ],
)

cc_library(
    name = "nobreak_visitor",
    srcs = ["nobreak_visitor.cc"],
    hdrs = ["nobreak_visitor.h"],
    deps = [
        ":visitor",
        "@rapidjson",
    ],
)

cc_library(
    name = "visitor",
    hdrs = ["visitor.h"],
    deps = [
        "@llvm-project//clang:ast",
    ],
)

cc_library(
    name = "cc_ast_tool_lib",
    srcs = ["cc_ast_tool_lib.cc"],
    hdrs = ["cc_ast_tool_lib.h"],
    deps = [
        ":frontend_action",
        "@absl//absl/status",
        "@absl//absl/status:statusor",
        "@absl//absl/strings",
        "@llvm-project//clang:ast",
        "@llvm-project//llvm:Support",
        "@llvm-project//clang:tooling",
    ],
)

cc_test(
    name = "cc_ast_tool_lib_test",
    srcs = ["cc_ast_tool_lib_test.cc"],
    deps = [
        ":cc_ast_tool_lib",
        ":cast_visitor",
        ":goto_visitor",
        ":nobreak_visitor",
        "@com_google_googletest//:gtest_main",
    ],
)