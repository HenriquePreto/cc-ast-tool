{
    "functions": [
        {
            "id": "/Users/henriquepreto/Desktop/cc-ast-tool/scripts/benchmarks/redis/src/networking.c#2563:1#readQueryFromClient",
            "gotos": 3,
            "labels": 1,
            "body": "{\n    client *c = connGetPrivateData(conn);\n    int nread, big_arg = 0;\n    int qblen(int *), readlen(int *);\n    if (postponeClientRead(c))\n        return;\n    <recovery-expr>(readlen, (1024 * 16));\n    if (c->reqtype == 2 && c->multibulklen && c->bulklen != -1 && c->bulklen >= (1024 * 32)) {\n        big_arg = 1;\n        if (<recovery-expr>(c) & (1 << 1) && readlen < (1024 * 16))\n            <recovery-expr>(readlen, (1024 * 16));\n    }\n    qblen = <recovery-expr>()(c->querybuf);\n    if (!(<recovery-expr>(c) & (1 << 1)) && (big_arg || <recovery-expr>()(c->querybuf) < (1024 * 16))) {\n        c->querybuf = <recovery-expr>()(c->querybuf, readlen);\n    } else {\n        c->querybuf = <recovery-expr>()(c->querybuf, readlen);\n        readlen = <recovery-expr>()(c->querybuf);\n    }\n    nread = <recovery-expr>()(c->conn, <recovery-expr>(c->querybuf, qblen), readlen);\n    if (nread == -1) {\n        if (connGetState(conn) == CONN_STATE_CONNECTED) {\n            return;\n        } else {\n            do {\n                if (((1) & 255) < server.verbosity)\n                    break;\n                _serverLog(1, \"Reading from client: %s\", connGetLastError(c->conn));\n            } while (0);\n            freeClientAsync(c);\n            goto done;\n        }\n    } else if (nread == 0) {\n        if (server.verbosity <= 1) {\n            sds info = catClientInfoString(sdsempty(), c);\n            do {\n                if (((1) & 255) < server.verbosity)\n                    break;\n                _serverLog(1, \"Client closed connection %s\", info);\n            } while (0);\n            sdsfree(info);\n        }\n        freeClientAsync(c);\n        goto done;\n    }\n    <recovery-expr>()(c->querybuf, nread);\n    qblen = <recovery-expr>()(c->querybuf);\n    if (<recovery-expr>(c) < qblen)\n        <recovery-expr>(c) = qblen;\n    <recovery-expr>(c) = <recovery-expr>(server);\n    if (<recovery-expr>(c) & (1 << 1)) {\n        c->read_reploff += nread;\n    } else {\n    }\n    if (!(<recovery-expr>(c) & (1 << 1)) && <recovery-expr>()(c->querybuf) > <recovery-expr>(server)) {\n        sds ci = catClientInfoString(sdsempty(), c), bytes = sdsempty();\n        bytes = <recovery-expr>()(bytes, c->querybuf, 64);\n        do {\n            if (((3) & 255) < server.verbosity)\n                break;\n            _serverLog(3, \"Closing client that reached max query buffer length: %s (qbuf initial bytes: %s)\", ci, bytes);\n        } while (0);\n        sdsfree(ci);\n        sdsfree(bytes);\n        freeClientAsync(c);\n        goto done;\n    }\n  done:\n    beforeNextClient(c);\n}\n"
        }
    ],
    "total": 199,
    "visited": 1
}
